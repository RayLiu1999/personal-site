apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: personal-site
  namespace: default
  labels:
    app: personal-site
spec:
  # entryPoints:
  #   - web # HTTP (port 80)
  #   - websecure # HTTPS (port 443)
  routes:
    - match: Host(`liu-yucheng.com`) || Host(`www.liu-yucheng.com`)
      kind: Rule
      services:
        - name: personal-site
          port: 80
      # middlewares:
      #   - name: secure-headers

---
# 中間件：HTTP 重定向到 HTTPS
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: redirect-to-https
  namespace: default
spec:
  redirectScheme:
    scheme: https
    permanent: true

---
# 中間件：安全標頭
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: secure-headers
  namespace: default
spec:
  headers:
    browserXssFilter: true
    contentTypeNosniff: true
    frameDeny: true
    sslRedirect: false
    stsIncludeSubdomains: true
    stsPreload: true
    stsSeconds: 31536000
    customResponseHeaders:
      X-Frame-Options: "SAMEORIGIN"
      X-XSS-Protection: "1; mode=block"
      X-Content-Type-Options: "nosniff"
      Referrer-Policy: "strict-origin-when-cross-origin"

---

